<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gemini Frontend for Docs Editing</title>
    <style>
    /* Clean, minimal styling */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f9f9f9;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      font-family: inherit;
    }
    textarea {
      resize: vertical;
    }
    button {
      padding: 10px 20px;
      background-color: #4285f4;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background-color: #357ae8;
    }
    .preset-btn {
      margin-bottom: 5px;
    }
    .counter {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9em;
      color: #555;
      margin-top: 5px;
    }
  </style>
</head>
<body>
<div class="container">
    <h1>Gemini Frontend</h1>

    <!-- API Key Input -->
    <div class="form-group">
        <label for="apiKey">API Key</label>
        <input type="text" id="apiKey" placeholder="Enter your Gemini API Key" />
    </div>

    <!-- System Prompt with Presets -->
    <div class="form-group">
        <label for="prompt">System Prompt</label>
        <div id="promptPresets">
            <!-- Default Summarize prompt -->
            <button type="button" class="preset-btn" data-prompt="You are a summarizer and keyword generator for technical documentation. The summaries should be about 150 characters, and the keywords should be about 3-6 relevant keywords. Generate three versions of each response, with different wording and length.\n\nUse the abbreviated form of any product names you see in the article.\n\nBlacklist of words you can't use: via, e.g., i.e., please, etc., latter\n\n\nReturn in this format:\ndescription: SUMMARY_GOES_HERE\nkeywords: [KEYWORD, KEYWORD, KEYWORD]">
                Summarize
            </button>
            <!-- Additional preset buttons -->
            <button type="button" class="preset-btn" data-prompt="You are a highly skilled database developer and application developer. Identify any logical inconsistencies in this article.">
                Logic Check
            </button>
            <button type="button" class="preset-btn" data-prompt="Custom prompt goes here.">
                Preset 3
            </button>
        </div>
        <textarea id="prompt" rows="6"></textarea>
    </div>

    <!-- Article Input -->
    <div class="form-group">
        <label for="article">Article Text</label>
        <textarea id="article" rows="10" placeholder="Paste your article text here"></textarea>
    </div>

    <!-- Submit Button -->
    <div class="form-group">
        <button type="button" id="submitBtn">Submit</button>
    </div>

    <!-- Response (Editable Output Box) -->
    <div class="form-group">
        <label for="editableOutput">Response</label>
        <textarea id="editableOutput" rows="10" placeholder="Response appears here for editing."></textarea>
        <div class="counter">
            <span>Characters: <span id="outputCharCount">0</span></span>
            <button type="button" id="copyOutput">Copy</button>
        </div>
    </div>
</div>

<script>
    // Set default prompt value.
    const defaultPrompt = "You are a summarizer and keyword generator for technical documentation. The summaries should be about 150 characters, and the keywords should be about 3-6 relevant keywords. Generate three versions of each response, with different wording and length.\n\nUse the abbreviated form of any product names you see in the article.\n\nBlacklist of words you can't use: via, e.g., i.e., please, etc., latter\n\nReturn in this format:\ndescription: SUMMARY_GOES_HERE\nkeywords: [KEYWORD, KEYWORD, KEYWORD]";
    document.getElementById('prompt').value = defaultPrompt;

    // Preset buttons populate the prompt textarea.
    const presetButtons = document.querySelectorAll('.preset-btn');
    presetButtons.forEach(button => {
      button.addEventListener('click', () => {
        const promptText = button.getAttribute('data-prompt');
        document.getElementById('prompt').value = promptText;
        console.log("Preset selected:", promptText);
      });
    });

    // Submit button event handler that calls the Gemini API.
    document.getElementById('submitBtn').addEventListener('click', async () => {
      console.log("Submit button clicked");

      // Retrieve API key, system prompt, and article text.
      const apiKey = document.getElementById('apiKey').value.trim();
      if (!apiKey) {
        console.error("API key is missing");
        alert("Please enter your API key.");
        return;
      }

      const systemInstruction = document.getElementById('prompt').value;
      const article = document.getElementById('article').value;
      if (!article) {
        console.error("Article text is missing");
        alert("Please enter the article text.");
        return;
      }

      // Prepare endpoint and payload per the Gemini API.
      const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`;
      const payload = {
        "contents": [
          {
            "role": "user",
            "parts": [
              { "text": article }
            ]
          }
        ],
        "systemInstruction": {
          "role": "user",
          "parts": [
            { "text": systemInstruction }
          ]
        },
        "generationConfig": {
          "temperature": 1,
          "topK": 40,
          "topP": 0.95,
          "maxOutputTokens": 8192,
          "responseMimeType": "text/plain"
        }
      };

      // Log endpoint and payload details.
      console.log("Endpoint:", endpoint);
      console.log("Payload sent:", JSON.stringify(payload, null, 2));

      try {
        console.log("Sending request to Gemini API...");
        const response = await fetch(endpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });
        console.log("HTTP Response Status:", response.status);
        const data = await response.json();
        console.log("Full API Response JSON:", JSON.stringify(data, null, 2));

        // Parse the output text from the API response.
        const resultText = (data.candidates && data.candidates[0] &&
          data.candidates[0].content &&
          data.candidates[0].content.parts &&
          data.candidates[0].content.parts[0] &&
          data.candidates[0].content.parts[0].text) || "No output returned";

        // Set the response text in the editable output box.
        const editableOutput = document.getElementById('editableOutput');
        editableOutput.value = resultText;
        document.getElementById('outputCharCount').textContent = resultText.length;
        console.log("API response text:", resultText);
      } catch (error) {
        console.error("Error during API call:", error);
        alert("An error occurred while contacting the API. Check console for details.");
      }
    });

    // Update character count in the Response box in real time.
    const editableOutput = document.getElementById('editableOutput');
    const outputCharCount = document.getElementById('outputCharCount');
    editableOutput.addEventListener('input', () => {
      outputCharCount.textContent = editableOutput.value.length;
    });

    // Copy button for the Response box.
    document.getElementById('copyOutput').addEventListener('click', () => {
      navigator.clipboard.writeText(editableOutput.value)
        .then(() => {
          console.log("Response copied to clipboard");
        })
        .catch(err => {
          console.error("Error copying text:", err);
        });
    });
  </script>
</body>
</html>
